<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Incident Atlas - Dashboard</title>
  <link rel="stylesheet" href="../static/css/dashboard.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h1 class="sidebar-title"><span class="title-red">Incident</span> <span class="title-white">Atlas</span></h1>
    </div>
    <nav class="sidebar-nav">
      <a href="/home" class="nav-item">
        <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M3 10L10 3L17 10V17C17 17.5304 16.7893 18.0391 16.4142 18.4142C16.0391 18.7893 15.5304 19 15 19H5C4.46957 19 3.96086 18.7893 3.58579 18.4142C3.21071 18.0391 3 17.5304 3 17V10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Home</span>
      </a>
      <a href="/dashboard" class="nav-item active">
        <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
          <rect x="3" y="3" width="6" height="6" rx="1" stroke="currentColor" stroke-width="2"/>
          <rect x="11" y="3" width="6" height="6" rx="1" stroke="currentColor" stroke-width="2"/>
          <rect x="3" y="11" width="6" height="6" rx="1" stroke="currentColor" stroke-width="2"/>
          <rect x="11" y="11" width="6" height="6" rx="1" stroke="currentColor" stroke-width="2"/>
        </svg>
        <span>Dashboard</span>
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Filter Cards Row -->
    <div class="filters-row">
      <!-- Card Mulheres -->
      <div class="filter-card clickable" id="filterWomen" data-active="true">
        <div class="filter-card-icon women">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
            <path d="M5 21V19C5 16.7909 6.79086 15 9 15H15C17.2091 15 19 16.7909 19 19V21" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="filter-card-content">
          <div class="filter-card-label">Mulheres</div>
          <div class="filter-card-value" id="womenCount">2</div>
          <div class="filter-card-percent" id="womenPercent">30%</div>
        </div>
      </div>

      <!-- Card Homens -->
      <div class="filter-card clickable" id="filterMen" data-active="true">
        <div class="filter-card-icon men">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
            <path d="M5 21V19C5 16.7909 6.79086 15 9 15H15C17.2091 15 19 16.7909 19 19V21" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="filter-card-content">
          <div class="filter-card-label">Homens</div>
          <div class="filter-card-value" id="menCount">2</div>
          <div class="filter-card-percent" id="menPercent">30%</div>
        </div>
      </div>

      <!-- Card Países -->
      <div class="filter-card clickable" id="filterCountries">
        <div class="filter-card-icon countries">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/>
            <path d="M3 12H21M12 3C14.5 6 14.5 18 12 21M12 3C9.5 6 9.5 18 12 21" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="filter-card-content">
          <div class="filter-card-label">Países</div>
          <div class="filter-card-value" id="countriesCount">3</div>
          <div class="filter-card-sublabel" id="countriesNames">Brasil, Portugal, Angola</div>
        </div>
      </div>

      <!-- Card Período -->
      <div class="filter-card clickable" id="filterPeriod">
        <div class="filter-card-icon period">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
            <path d="M16 2V6M8 2V6M3 10H21" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="filter-card-content">
          <div class="filter-card-label">Período Analisado</div>
          <div class="filter-card-value" id="periodDays">12 days</div>
          <div class="filter-card-sublabel" id="periodRange">Jan 2016 - Oct 2017</div>
        </div>
      </div>
    </div>

    <!-- Charts Grid -->
    <div class="charts-grid">
      <!-- Linha 1: Gráfico Mensal + Gráfico Setores -->
      <div class="chart-row">
        <!-- Quantidade de Acidentes - Mês -->
        <div class="chart-card chart-monthly">
          <div class="chart-header">
            <h3 class="chart-title">Quantidade de acidentes - Mês</h3>
          </div>
          <div class="chart-controls">
            <select id="monthRangeFilter" class="chart-filter">
              <option value="all">Todo o período</option>
              <option value="6">Últimos 6 meses</option>
              <option value="3">Últimos 3 meses</option>
              <option value="1">Último mês</option>
            </select>
          </div>
          <canvas id="accidentsPerMonthChart"></canvas>
        </div>

        <!-- Potencial de Acidentes - Setores -->
        <div class="chart-card chart-sectors">
          <div class="chart-header">
            <h3 class="chart-title">Potencial de Acidentes - Setores</h3>
          </div>
          <div class="chart-legend-wrapper">
            <canvas id="accidentPotentialChart"></canvas>
            <div class="chart-legend" id="potentialLegend"></div>
          </div>
        </div>
      </div>

      <!-- Linha 2: Mapa de Calor + Lista de Incidentes -->
      <div class="chart-row">
        <!-- Membros Mais Afetados -->
        <div class="chart-card chart-bodymap">
          <div class="chart-header">
            <h3 class="chart-title">Membros mais Afetados</h3>
          </div>
          <div class="body-map-container">
            <svg id="bodyHeatmap" viewBox="0 0 200 400" class="body-svg-enhanced">
              <!-- Cabeça -->
              <circle id="head" class="body-part" cx="100" cy="40" r="25" data-name="Cabeça" data-count="0" />
              
              <!-- Olhos -->
              <g id="eyes" class="body-part" data-name="Olhos" data-count="0">
                <circle cx="92" cy="35" r="4" />
                <circle cx="108" cy="35" r="4" />
              </g>
              
              <!-- Tronco -->
              <rect id="trunk" class="body-part" x="75" y="70" width="50" height="80" rx="10" data-name="Tronco" data-count="0" />
              
              <!-- Braço Esquerdo -->
              <rect id="arms-left" class="body-part" x="45" y="75" width="25" height="70" rx="8" data-name="Braço Esquerdo" data-count="0" />
              
              <!-- Braço Direito -->
              <rect id="arms-right" class="body-part" x="130" y="75" width="25" height="70" rx="8" data-name="Braço Direito" data-count="0" />
              
              <!-- Mãos -->
              <g id="hands" class="body-part" data-name="Mãos e Dedos" data-count="0">
                <ellipse cx="57" cy="155" rx="12" ry="15" />
                <rect x="52" y="170" width="3" height="8" rx="1.5" />
                <rect x="56" y="170" width="3" height="10" rx="1.5" />
                <rect x="60" y="170" width="3" height="9" rx="1.5" />
                <rect x="64" y="170" width="3" height="7" rx="1.5" />
                <ellipse cx="143" cy="155" rx="12" ry="15" />
                <rect x="135" y="170" width="3" height="8" rx="1.5" />
                <rect x="139" y="170" width="3" height="10" rx="1.5" />
                <rect x="143" y="170" width="3" height="9" rx="1.5" />
                <rect x="147" y="170" width="3" height="7" rx="1.5" />
              </g>
              
              <!-- Pernas -->
              <g id="legs" class="body-part" data-name="Pernas" data-count="0">
                <rect x="80" y="155" width="18" height="90" rx="8" />
                <rect x="102" y="155" width="18" height="90" rx="8" />
              </g>
              
              <!-- Pés -->
              <g id="feet" class="body-part" data-name="Pés" data-count="0">
                <ellipse cx="89" cy="255" rx="12" ry="18" />
                <ellipse cx="111" cy="255" rx="12" ry="18" />
              </g>
            </svg>
            
            <!-- Tooltip -->
            <div id="body-tooltip" class="body-tooltip"></div>
          </div>
          
          <!-- Legenda de Intensidade -->
          <div class="body-map-legend">
            <div class="legend-title">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M10 2L12 8L18 9L14 13L15 19L10 16L5 19L6 13L2 9L8 8L10 2Z" fill="currentColor" />
              </svg>
              Intensidade
            </div>
            <div class="legend-items">
              <div class="legend-item">
                <span class="legend-color" style="background: #FDE047; border: 1px solid #EAB308;"></span>
                <span>Mínimo (1-25%)</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: #FB923C; border: 1px solid #F97316;"></span>
                <span>Baixo (26-50%)</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: #F87171; border: 1px solid #EF4444;"></span>
                <span>Médio (51-75%)</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: #DC2626; border: 1px solid #B91C1C;"></span>
                <span>Alto (76-100%)</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Descrição dos Incidentes -->
        <div class="chart-card chart-incidents">
          <div class="chart-header">
            <h3 class="chart-title">Descrição dos Incidentes</h3>
          </div>
          <div class="incidents-search-container">
            <input type="text" id="incidentsSearch" class="incidents-search-input" placeholder="Buscar por país, estado, descrição, data, nível...">
          </div>
          <div class="incidents-list" id="incidentsList">
            <!-- Populated by JS -->
          </div>
          <div class="incidents-loading" id="incidentsLoading" style="display: none;">
            Carregando mais incidentes...
          </div>
        </div>
      </div>

      <!-- Linha 3: Gráfico de Localização (toda a largura) -->
      <div class="chart-row">
        <!-- Quantidade de Acidentes - Local -->
        <div class="chart-card chart-locations">
          <div class="chart-header">
            <h3 class="chart-title">Quantidade de Acidentes - Local</h3>
          </div>
          <div class="chart-controls">
            <select id="countryFilter" class="chart-filter">
              <option value="all">Todos os países</option>
              <option value="Country_01">País 1</option>
              <option value="Country_02">País 2</option>
            </select>
          </div>
          <canvas id="accidentsByLocationChart"></canvas>
        </div>
      </div>
    </div>
  </main>

  <!-- Modal para Descrição de Incidente -->
  <div id="incidentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Detalhes do Incidente</h2>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>
      <div class="modal-body">
        <div class="modal-info">
          <strong>ID:</strong> <span id="modalId"></span>
        </div>
        <div class="modal-info">
          <strong>Data:</strong> <span id="modalDate"></span>
        </div>
        <div class="modal-info">
          <strong>Local:</strong> <span id="modalLocation"></span>
        </div>
        <div class="modal-info">
          <strong>País:</strong> <span id="modalCountry"></span>
        </div>
        <div class="modal-info">
          <strong>Setor:</strong> <span id="modalSector"></span>
        </div>
        <div class="modal-info">
          <strong>Nível de Acidente:</strong> <span id="modalLevel"></span>
        </div>
        <div class="modal-info">
          <strong>Risco Crítico:</strong> <span id="modalRisk"></span>
        </div>
        <div class="modal-description">
          <strong>Descrição:</strong>
          <p id="modalDescription"></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para Filtro de Países -->
  <div id="countriesModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Selecionar Países</h2>
        <button class="modal-close" id="countriesModalClose">&times;</button>
      </div>
      <div class="modal-body">
        <div class="countries-filter-list" id="countriesFilterList">
          <!-- Populated by JS -->
        </div>
        <div class="modal-actions">
          <button class="btn-secondary" id="countriesClearAll">Limpar Todos</button>
          <button class="btn-primary" id="countriesSelectAll">Selecionar Todos</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para Filtro de Período -->
  <div id="periodModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Selecionar Período</h2>
        <button class="modal-close" id="periodModalClose">&times;</button>
      </div>
      <div class="modal-body">
        <div class="date-picker-container">
          <div class="date-input-group">
            <label for="startDate">Data Inicial:</label>
            <input type="date" id="startDate" class="date-input">
          </div>
          <div class="date-input-group">
            <label for="endDate">Data Final:</label>
            <input type="date" id="endDate" class="date-input">
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn-secondary" id="periodCancel">Cancelar</button>
          <button class="btn-primary" id="periodApply">Aplicar</button>
        </div>
      </div>
    </div>
  </div>

  <script src="../static/js/dashboard.js?v=1.2"></script>
</body>
</html>